<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nusa Media - Portal Berita Terpercaya</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .news-card:hover {
            transform: translateY(-5px);
            transition: all 0.3s ease;
        }
        .breaking-news {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Responsive utilities */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Container responsive padding */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        @media (max-width: 640px) {
            .container {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
        }
        
        @media (min-width: 641px) and (max-width: 1024px) {
            .container {
                padding-left: 1.5rem;
                padding-right: 1.5rem;
            }
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .news-card:hover {
                transform: none;
            }
            
            .news-card {
                margin-bottom: 0.5rem;
            }
            
            /* Better mobile typography */
            h1 { font-size: 1.25rem !important; }
            h2 { font-size: 1.125rem !important; }
            h3 { font-size: 1rem !important; }
            
            /* Mobile spacing */
            .p-4 { padding: 0.75rem !important; }
            .p-6 { padding: 1rem !important; }
            .py-8 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
            
            /* Mobile grid adjustments */
            .grid-cols-2 { grid-template-columns: repeat(2, 1fr) !important; }
        }
        
        /* Tablet optimizations */
        @media (min-width: 641px) and (max-width: 1024px) {
            .news-card {
                margin-bottom: 0.75rem;
            }
            
            /* Tablet typography */
            h1 { font-size: 1.5rem !important; }
            h2 { font-size: 1.25rem !important; }
            
            /* Tablet spacing */
            .p-6 { padding: 1.25rem !important; }
        }
        
        /* Desktop optimizations */
        @media (min-width: 1025px) {
            .news-card:hover {
                transform: translateY(-5px);
                transition: all 0.3s ease;
                box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            }
        }
        
        /* Smooth transitions */
        #mobileNav {
            transition: all 0.3s ease;
        }
        
        #mobileSearchBar {
            transition: all 0.3s ease;
        }
        
        /* Touch targets for mobile */
        @media (max-width: 768px) {
            button, .nav-link {
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 12px 16px;
            }
            
            .nav-link {
                text-align: center;
                border-radius: 0.375rem;
            }
            
            /* Mobile button sizing */
            .btn-mobile {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
        }
        
        /* Responsive images */
        .news-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        @media (max-width: 640px) {
            .news-image {
                height: 150px;
            }
        }
        
        @media (min-width: 1025px) {
            .news-image {
                height: 220px;
            }
        }
        
        /* Responsive aspect ratios */
        .aspect-square {
            aspect-ratio: 1 / 1;
        }
        
        @media (max-width: 640px) {
            .aspect-mobile {
                aspect-ratio: 4 / 3;
            }
        }
        
        /* Modal responsiveness */
        @media (max-width: 640px) {
            .modal-content {
                margin: 0.5rem;
                max-height: 95vh;
                border-radius: 0.5rem;
            }
        }
        
        /* Footer responsive */
        @media (max-width: 640px) {
            .footer-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }
        
        @media (min-width: 641px) and (max-width: 1024px) {
            .footer-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 2rem;
            }
        }

        /* Image preview styles */
        .image-preview {
            position: relative;
            display: inline-block;
        }
        
        .image-preview img {
            max-width: 150px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .remove-image {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Login Admin</h2>
                <button onclick="closeLoginModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Username</label>
                    <input type="text" id="loginUsername" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div id="loginError" class="text-red-500 text-sm mb-4 hidden"></div>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">Login</button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <div class="bg-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <img src="https://nusa-media.github.io/nusamedia/logo.png" alt="NusaMedia Logo" class="h-10 w-10 mr-3">
                        <h1 class="text-2xl font-bold text-red-600">ADMIN NUSAMEDIA</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <span class="text-gray-600">Selamat datang, Admin</span>
                            <div id="connectionStatus" class="flex items-center text-sm">
                                <div class="w-2 h-2 rounded-full mr-1" id="statusDot"></div>
                                <span id="statusText">Checking...</span>
                            </div>
                        </div>
                        <button onclick="syncData()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" id="syncBtn">
                            <i class="fas fa-sync mr-2"></i>Sinkronisasi
                        </button>
                        <button onclick="showMainSite()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            <i class="fas fa-eye mr-2"></i>Lihat Website
                        </button>
                        <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container mx-auto px-4 py-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center">
                        <div class="bg-blue-500 text-white p-3 rounded-full">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-gray-500 text-sm">Total Berita</p>
                            <p class="text-2xl font-bold" id="totalNews">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center">
                        <div class="bg-green-500 text-white p-3 rounded-full">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-gray-500 text-sm">Total Views</p>
                            <p class="text-2xl font-bold" id="totalViews">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center">
                        <div class="bg-purple-500 text-white p-3 rounded-full">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-gray-500 text-sm">Kategori</p>
                            <p class="text-2xl font-bold">8</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center">
                        <div class="bg-orange-500 text-white p-3 rounded-full">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-gray-500 text-sm">Hari Ini</p>
                            <p class="text-2xl font-bold" id="todayNews">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add News Form -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-xl font-bold mb-6">Tambah Berita Baru</h2>
                <form onsubmit="addNews(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Judul Berita *</label>
                            <input type="text" id="newsTitle" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Kategori *</label>
                            <select id="newsCategory" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Pilih Kategori</option>
                                <option value="umum">Umum</option>
                                <option value="politik">Politik</option>
                                <option value="ekonomi">Ekonomi</option>
                                <option value="olahraga">Olahraga</option>
                                <option value="teknologi">Teknologi</option>
                                <option value="hiburan">Hiburan</option>
                                <option value="pendidikan">Pendidikan</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Penulis</label>
                            <input type="text" id="newsAuthor" value="Tim Redaksi" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Ringkasan Berita</label>
                            <textarea id="newsExcerpt" rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ringkasan singkat berita..."></textarea>
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Isi Berita *</label>
                            <textarea id="newsContent" rows="8" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Tulis isi berita lengkap di sini..." required></textarea>
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Foto Berita (Maksimal 4)</label>
                            <input type="file" id="newsImages" multiple accept="image/*" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="previewImages()">
                            <p class="text-gray-500 text-sm mt-1">Format: JPG, PNG, GIF. Maksimal 4 foto.</p>
                            <div id="imagePreview" class="mt-4 flex flex-wrap gap-4"></div>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-4">
                        <button type="button" onclick="resetForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">Reset</button>
                        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i>Tambah Berita
                        </button>
                    </div>
                </form>
            </div>

            <!-- Google Sheets Setup Instructions -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8" id="setupInstructions">
                <h2 class="text-xl font-bold mb-4 text-blue-800">
                    <i class="fas fa-info-circle mr-2"></i>Setup Google Sheets Database
                </h2>
                <div class="space-y-4 text-sm">
                    <div>
                        <h3 class="font-semibold text-blue-700 mb-2">1. Buat Google Sheet Baru:</h3>
                        <p class="text-blue-600 mb-2">Buat spreadsheet dengan kolom berikut di baris pertama:</p>
                        <div class="bg-white p-3 rounded border font-mono text-xs">
                            ID | Title | Category | Author | Excerpt | Content | Images | Date | Time | Views
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold text-blue-700 mb-2">2. Buat Google Apps Script:</h3>
                        <p class="text-blue-600 mb-2">Buka Extensions → Apps Script dan paste kode berikut:</p>
                        <div class="bg-gray-800 text-green-400 p-4 rounded text-xs overflow-x-auto">
                            <pre id="gasCode">// Google Apps Script Code akan ditampilkan di sini
// Klik tombol "Tampilkan Kode" untuk melihat</pre>
                        </div>
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button onclick="showGASCode()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm">
                                <i class="fas fa-code mr-2"></i>Tampilkan Kode Google Apps Script
                            </button>
                            <button onclick="testConnection()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-sm">
                                <i class="fas fa-wifi mr-2"></i>Test Koneksi
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold text-blue-700 mb-2">3. Deploy sebagai Web App:</h3>
                        <ul class="text-blue-600 space-y-1 ml-4">
                            <li>• Klik Deploy → New deployment</li>
                            <li>• Type: Web app</li>
                            <li>• Execute as: Me</li>
                            <li>• Who has access: Anyone</li>
                            <li>• Copy URL dan ganti YOUR_SCRIPT_ID di kode</li>
                        </ul>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded p-3">
                        <p class="text-yellow-800 text-sm">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            <strong>Penting:</strong> Ganti <code>YOUR_SCRIPT_ID</code> di line 762 dengan ID Google Apps Script Anda
                        </p>
                    </div>
                    
                    <!-- Debug Information -->
                    <div class="bg-blue-50 border border-blue-200 rounded p-4 mt-4">
                        <h3 class="font-semibold text-blue-700 mb-2">🔍 Debug Information:</h3>
                        <div class="text-blue-600 space-y-2 text-xs">
                            <div>
                                <strong>Current Script URL:</strong>
                                <p class="font-mono bg-white p-2 rounded mt-1 break-all" id="currentScriptUrl">Loading...</p>
                            </div>
                            <div>
                                <strong>Connection Status:</strong>
                                <p id="debugConnectionStatus">Checking...</p>
                            </div>
                            <div>
                                <strong>Local News Count:</strong>
                                <p id="debugLocalNewsCount">Loading...</p>
                            </div>
                            <div>
                                <strong>Last Sync Attempt:</strong>
                                <p id="debugLastSync">Never</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Troubleshooting Section -->
                    <div class="bg-red-50 border border-red-200 rounded p-4 mt-4">
                        <h3 class="font-semibold text-red-700 mb-2">🔧 Troubleshooting - Jika Sinkronisasi Gagal:</h3>
                        <div class="text-red-600 space-y-2 text-xs">
                            <div>
                                <strong>❌ Problem: "YOUR_SCRIPT_ID belum diganti"</strong>
                                <p>• Script URL masih menggunakan placeholder</p>
                                <p>• Ganti YOUR_SCRIPT_ID dengan ID dari URL deployment Anda</p>
                            </div>
                            
                            <div>
                                <strong>❌ Problem: "Failed to fetch" atau "CORS error"</strong>
                                <p>• Pastikan Google Apps Script sudah di-deploy dengan benar</p>
                                <p>• Pastikan "Who has access" = Anyone (bukan "Only myself")</p>
                                <p>• Coba deploy ulang dengan versi baru</p>
                            </div>
                            
                            <div>
                                <strong>❌ Problem: "404 Not Found"</strong>
                                <p>• ID Script salah atau belum di-deploy</p>
                                <p>• Pastikan menggunakan Web App URL, bukan Script URL</p>
                            </div>
                            
                            <div>
                                <strong>✅ Cara Mendapatkan ID Script yang Benar:</strong>
                                <p>• Setelah deploy, copy Web App URL</p>
                                <p>• Contoh: https://script.google.com/macros/s/<strong>AKfycbx...</strong>/exec</p>
                                <p>• Bagian <strong>AKfycbx...</strong> adalah ID yang harus digunakan</p>
                            </div>
                            
                            <div>
                                <strong>🔧 Langkah Debugging:</strong>
                                <p>1. Buka Console Browser (F12)</p>
                                <p>2. Lihat error message yang muncul</p>
                                <p>3. Coba tambah berita dan lihat log</p>
                                <p>4. Coba klik tombol "Test Koneksi"</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent News -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold mb-6">Berita Terbaru</h2>
                <div id="adminNewsList" class="space-y-4">
                    <!-- Admin news list will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit News Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Edit Berita</h2>
                    <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <form onsubmit="updateNews(event)">
                    <input type="hidden" id="editNewsId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Judul Berita *</label>
                            <input type="text" id="editNewsTitle" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Kategori *</label>
                            <select id="editNewsCategory" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Pilih Kategori</option>
                                <option value="umum">Umum</option>
                                <option value="politik">Politik</option>
                                <option value="ekonomi">Ekonomi</option>
                                <option value="olahraga">Olahraga</option>
                                <option value="teknologi">Teknologi</option>
                                <option value="hiburan">Hiburan</option>
                                <option value="pendidikan">Pendidikan</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Penulis</label>
                            <input type="text" id="editNewsAuthor" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Ringkasan Berita</label>
                            <textarea id="editNewsExcerpt" rows="3" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Isi Berita *</label>
                            <textarea id="editNewsContent" rows="8" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Foto Berita (Maksimal 4)</label>
                            <input type="file" id="editNewsImages" multiple accept="image/*" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="previewEditImages()">
                            <p class="text-gray-500 text-sm mt-1">Format: JPG, PNG, GIF. Maksimal 4 foto. Kosongkan jika tidak ingin mengubah foto.</p>
                            <div id="editImagePreview" class="mt-4 flex flex-wrap gap-4"></div>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-4">
                        <button type="button" onclick="closeEditModal()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">Batal</button>
                        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-save mr-2"></i>Simpan Perubahan
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Website -->
    <div id="mainWebsite">
        <!-- Header -->
        <header class="bg-white shadow-lg sticky top-0 z-50">
            <div class="container mx-auto px-4">
                <!-- Top Bar - Hidden on mobile -->
                <div class="hidden lg:flex justify-between items-center py-2 text-sm text-gray-600 border-b">
                    <div class="flex items-center space-x-4">
                        <span><i class="far fa-calendar"></i> <span id="currentDate">Loading...</span></span>
                    </div>
                    <div class="flex items-center space-x-2 xl:space-x-4 text-xs">
                        <a href="#" class="hover:text-blue-600 hidden xl:inline">Tentang Kami</a>
                        <a href="#" class="hover:text-blue-600 hidden xl:inline">Box Redaksi</a>
                        <a href="#" class="hover:text-blue-600">Kontak</a>
                        <a href="#" class="hover:text-blue-600 hidden xl:inline">Pedoman Cyber</a>
                        <a href="#" class="hover:text-blue-600 hidden xl:inline">SOP Wartawan</a>
                        <a href="#" class="hover:text-blue-600 hidden xl:inline">Kode Etik</a>
                        <a href="#" class="hover:text-blue-600">Iklan</a>
                    </div>
                </div>
                
                <!-- Main Header -->
                <div class="flex justify-between items-center py-3 sm:py-4">
                    <div class="flex items-center min-w-0 flex-1">
                        <img src="https://nusa-media.github.io/nusamedia/logo.png" alt="NusaMedia Logo" class="h-8 w-8 sm:h-10 sm:w-10 mr-2 sm:mr-3 flex-shrink-0">
                        <div class="flex flex-col min-w-0">
                            <h1 class="text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-red-600 cursor-pointer truncate" onclick="showAllNews()">NUSAMEDIA</h1>
                            <span class="text-xs sm:text-sm text-gray-500 hidden sm:block">Portal Berita Terpercaya</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-1 sm:space-x-2 md:space-x-3 flex-shrink-0">
                        <!-- Mobile Menu Button -->
                        <button id="mobileMenuBtn" class="lg:hidden text-gray-600 hover:text-red-600 p-2">
                            <i class="fas fa-bars text-lg"></i>
                        </button>
                        <!-- Search - Hidden on mobile -->
                        <div class="relative hidden md:block">
                            <input type="text" id="searchInput" placeholder="Cari berita..." class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-32 md:w-40 lg:w-56 xl:w-64 text-sm">
                            <button onclick="performSearch()" class="fas fa-search absolute left-3 top-3 text-gray-400 hover:text-blue-600 cursor-pointer"></button>
                        </div>
                        <!-- Mobile Search Button -->
                        <button id="mobileSearchBtn" class="md:hidden text-gray-600 hover:text-red-600 p-2">
                            <i class="fas fa-search text-lg"></i>
                        </button>
                        <button onclick="showLoginModal()" class="bg-blue-600 text-white px-2 py-2 sm:px-3 rounded-lg hover:bg-blue-700 text-xs sm:text-sm btn-mobile">
                            <i class="fas fa-user-shield sm:mr-1"></i><span class="hidden sm:inline">Admin</span>
                        </button>
                        <button class="bg-red-600 text-white px-2 py-2 sm:px-3 rounded-lg hover:bg-red-700 text-xs sm:text-sm btn-mobile">
                            <i class="fas fa-play sm:mr-1"></i><span class="hidden sm:inline">LIVE</span>
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Search Bar -->
                <div id="mobileSearchBar" class="hidden sm:hidden pb-4">
                    <div class="relative">
                        <input type="text" id="mobileSearchInput" placeholder="Cari berita..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button onclick="performMobileSearch()" class="fas fa-search absolute left-3 top-3 text-gray-400 hover:text-blue-600 cursor-pointer"></button>
                    </div>
                </div>
                
                <!-- Navigation -->
                <nav class="py-2 sm:py-3 border-t">
                    <!-- Desktop Navigation -->
                    <ul class="hidden lg:flex space-x-3 xl:space-x-6 text-sm font-medium overflow-x-auto scrollbar-hide">
                        <li><a href="#" onclick="showCategory('beranda')" class="nav-link text-red-600 hover:text-red-800 whitespace-nowrap px-2 py-1">BERANDA</a></li>
                        <li><a href="#" onclick="showCategory('umum')" class="nav-link text-gray-700 hover:text-red-600 whitespace-nowrap px-2 py-1">UMUM</a></li>
                        <li><a href="#" onclick="showCategory('politik')" class="nav-link text-gray-700 hover:text-red-600 whitespace-nowrap px-2 py-1">POLITIK</a></li>
                        <li><a href="#" onclick="showCategory('ekonomi')" class="nav-link text-gray-700 hover:text-red-600 whitespace-nowrap px-2 py-1">EKONOMI</a></li>
                        <li><a href="#" onclick="showCategory('olahraga')" class="nav-link text-gray-700 hover:text-red-600 whitespace-nowrap px-2 py-1">OLAHRAGA</a></li>
                        <li><a href="#" onclick="showCategory('teknologi')" class="nav-link text-gray-700 hover:text-red-600 whitespace-nowrap px-2 py-1">TEKNOLOGI</a></li>
                        <li><a href="#" onclick="showCategory('hiburan')" class="nav-link text-gray-700 hover:text-red-600 whitespace-nowrap px-2 py-1">HIBURAN</a></li>
                        <li><a href="#" onclick="showCategory('pendidikan')" class="nav-link text-gray-700 hover:text-red-600 whitespace-nowrap px-2 py-1">PENDIDIKAN</a></li>
                    </ul>
                    
                    <!-- Tablet Navigation -->
                    <div class="hidden md:block lg:hidden">
                        <div class="flex flex-wrap justify-center gap-2 text-sm font-medium">
                            <a href="#" onclick="showCategory('beranda')" class="nav-link text-red-600 hover:text-red-800 px-3 py-2 rounded bg-red-50">BERANDA</a>
                            <a href="#" onclick="showCategory('umum')" class="nav-link text-gray-700 hover:text-red-600 px-3 py-2 rounded hover:bg-gray-50">UMUM</a>
                            <a href="#" onclick="showCategory('politik')" class="nav-link text-gray-700 hover:text-red-600 px-3 py-2 rounded hover:bg-gray-50">POLITIK</a>
                            <a href="#" onclick="showCategory('ekonomi')" class="nav-link text-gray-700 hover:text-red-600 px-3 py-2 rounded hover:bg-gray-50">EKONOMI</a>
                            <a href="#" onclick="showCategory('olahraga')" class="nav-link text-gray-700 hover:text-red-600 px-3 py-2 rounded hover:bg-gray-50">OLAHRAGA</a>
                            <a href="#" onclick="showCategory('teknologi')" class="nav-link text-gray-700 hover:text-red-600 px-3 py-2 rounded hover:bg-gray-50">TEKNOLOGI</a>
                            <a href="#" onclick="showCategory('hiburan')" class="nav-link text-gray-700 hover:text-red-600 px-3 py-2 rounded hover:bg-gray-50">HIBURAN</a>
                            <a href="#" onclick="showCategory('pendidikan')" class="nav-link text-gray-700 hover:text-red-600 px-3 py-2 rounded hover:bg-gray-50">PENDIDIKAN</a>
                        </div>
                    </div>
                    
                    <!-- Mobile Navigation -->
                    <div id="mobileNav" class="md:hidden hidden">
                        <div class="grid grid-cols-2 gap-2 text-sm font-medium p-2">
                            <a href="#" onclick="showCategory('beranda')" class="nav-link text-red-600 hover:text-red-800 py-3 px-3 rounded-lg text-center bg-red-50 font-semibold">BERANDA</a>
                            <a href="#" onclick="showCategory('umum')" class="nav-link text-gray-700 hover:text-red-600 py-3 px-3 rounded-lg text-center bg-gray-50 hover:bg-red-50">UMUM</a>
                            <a href="#" onclick="showCategory('politik')" class="nav-link text-gray-700 hover:text-red-600 py-3 px-3 rounded-lg text-center bg-gray-50 hover:bg-red-50">POLITIK</a>
                            <a href="#" onclick="showCategory('ekonomi')" class="nav-link text-gray-700 hover:text-red-600 py-3 px-3 rounded-lg text-center bg-gray-50 hover:bg-red-50">EKONOMI</a>
                            <a href="#" onclick="showCategory('olahraga')" class="nav-link text-gray-700 hover:text-red-600 py-3 px-3 rounded-lg text-center bg-gray-50 hover:bg-red-50">OLAHRAGA</a>
                            <a href="#" onclick="showCategory('teknologi')" class="nav-link text-gray-700 hover:text-red-600 py-3 px-3 rounded-lg text-center bg-gray-50 hover:bg-red-50">TEKNOLOGI</a>
                            <a href="#" onclick="showCategory('hiburan')" class="nav-link text-gray-700 hover:text-red-600 py-3 px-3 rounded-lg text-center bg-gray-50 hover:bg-red-50">HIBURAN</a>
                            <a href="#" onclick="showCategory('pendidikan')" class="nav-link text-gray-700 hover:text-red-600 py-3 px-3 rounded-lg text-center bg-gray-50 hover:bg-red-50">PENDIDIKAN</a>
                        </div>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-3 sm:px-4 py-3 sm:py-6 lg:py-8">
            <div class="grid grid-cols-1 xl:grid-cols-4 gap-4 lg:gap-6 xl:gap-8">
                <!-- Left Content -->
                <div class="xl:col-span-3">
                    <!-- Latest News -->
                    <section class="mb-6 lg:mb-8">
                        <div class="flex items-center justify-between mb-4 lg:mb-6">
                            <h2 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-800" id="sectionTitle">Berita Terkini</h2>
                            <a href="#" class="text-blue-600 hover:text-blue-800 text-sm font-medium hidden sm:block">Lihat Semua →</a>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-3 md:gap-4 lg:gap-5" id="newsContainer">
                            <!-- News will be populated here -->
                        </div>
                    </section>
                </div>

                <!-- Sidebar -->
                <aside class="xl:col-span-1">
                    <!-- Popular News -->
                    <div class="bg-white rounded-lg shadow-md p-3 sm:p-4 lg:p-6 mb-6 sticky top-20">
                        <h3 class="text-base sm:text-lg font-bold mb-3 sm:mb-4 text-gray-800">Berita Populer</h3>
                        <div class="space-y-3 sm:space-y-4">
                            <article class="flex items-start space-x-2 sm:space-x-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <span class="bg-red-600 text-white text-xs font-bold px-2 py-1 rounded flex-shrink-0">1</span>
                                <div class="min-w-0">
                                    <h4 class="text-xs sm:text-sm font-medium text-gray-800 hover:text-blue-600 line-clamp-2">Harga BBM Turun Mulai Januari 2025</h4>
                                    <p class="text-xs text-gray-500 mt-1">2 jam lalu • 2.1K views</p>
                                </div>
                            </article>
                            
                            <article class="flex items-start space-x-2 sm:space-x-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <span class="bg-orange-500 text-white text-xs font-bold px-2 py-1 rounded flex-shrink-0">2</span>
                                <div class="min-w-0">
                                    <h4 class="text-xs sm:text-sm font-medium text-gray-800 hover:text-blue-600 line-clamp-2">Gempa 6.2 SR Guncang Sumatra Barat</h4>
                                    <p class="text-xs text-gray-500 mt-1">4 jam lalu • 1.8K views</p>
                                </div>
                            </article>
                            
                            <article class="flex items-start space-x-2 sm:space-x-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <span class="bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded flex-shrink-0">3</span>
                                <div class="min-w-0">
                                    <h4 class="text-xs sm:text-sm font-medium text-gray-800 hover:text-blue-600 line-clamp-2">Vaksin COVID-19 Varian Baru Tiba di Indonesia</h4>
                                    <p class="text-xs text-gray-500 mt-1">6 jam lalu • 1.5K views</p>
                                </div>
                            </article>
                            
                            <article class="flex items-start space-x-2 sm:space-x-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <span class="bg-green-500 text-white text-xs font-bold px-2 py-1 rounded flex-shrink-0">4</span>
                                <div class="min-w-0">
                                    <h4 class="text-xs sm:text-sm font-medium text-gray-800 hover:text-blue-600 line-clamp-2">Ekspor Indonesia Naik 15% di Kuartal III</h4>
                                    <p class="text-xs text-gray-500 mt-1">8 jam lalu • 1.2K views</p>
                                </div>
                            </article>
                            
                            <article class="flex items-start space-x-2 sm:space-x-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <span class="bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded flex-shrink-0">5</span>
                                <div class="min-w-0">
                                    <h4 class="text-xs sm:text-sm font-medium text-gray-800 hover:text-blue-600 line-clamp-2">Program Beasiswa Mahasiswa Berprestasi</h4>
                                    <p class="text-xs text-gray-500 mt-1">10 jam lalu • 950 views</p>
                                </div>
                            </article>
                        </div>
                    </div>
                </aside>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-6 sm:py-8 lg:py-12">
            <div class="container mx-auto px-3 sm:px-4">
                <div class="footer-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 lg:gap-8">
                    <div class="sm:col-span-2 lg:col-span-1">
                        <div class="flex items-center mb-3 sm:mb-4">
                            <img src="https://nusa-media.github.io/nusamedia/logo.png" alt="NusaMedia Logo" class="h-6 w-6 sm:h-8 sm:w-8 mr-2 sm:mr-3">
                            <h3 class="text-lg sm:text-xl font-bold text-red-600">NUSAMEDIA</h3>
                        </div>
                        <p class="text-gray-300 text-xs sm:text-sm mb-3 sm:mb-4 leading-relaxed">Portal berita terpercaya yang menyajikan informasi terkini dan akurat untuk masyarakat Indonesia.</p>
                        <div class="flex space-x-3 sm:space-x-4">
                            <a href="#" class="text-gray-300 hover:text-white text-base sm:text-lg transition-colors p-1"><i class="fab fa-facebook"></i></a>
                            <a href="#" class="text-gray-300 hover:text-white text-base sm:text-lg transition-colors p-1"><i class="fab fa-tiktok"></i></a>
                            <a href="#" class="text-gray-300 hover:text-white text-base sm:text-lg transition-colors p-1"><i class="fab fa-instagram"></i></a>
                            <a href="#" class="text-gray-300 hover:text-white text-base sm:text-lg transition-colors p-1"><i class="fab fa-youtube"></i></a>
                            <a href="#" class="text-gray-300 hover:text-white text-base sm:text-lg transition-colors p-1"><i class="fab fa-whatsapp"></i></a>
                            <a href="#" class="text-gray-300 hover:text-white text-base sm:text-lg transition-colors p-1"><i class="fab fa-twitter"></i></a>
                        </div>
                    </div>
                    
                    <div class="text-left">
                        <h4 class="font-bold mb-3 sm:mb-4 text-sm sm:text-base">Kategori</h4>
                        <ul class="space-y-1 sm:space-y-2 text-xs sm:text-sm text-gray-300">
                            <li><a href="#" onclick="showCategory('umum')" class="hover:text-white transition-colors py-1 block">Umum</a></li>
                            <li><a href="#" onclick="showCategory('politik')" class="hover:text-white transition-colors py-1 block">Politik</a></li>
                            <li><a href="#" onclick="showCategory('ekonomi')" class="hover:text-white transition-colors py-1 block">Ekonomi</a></li>
                            <li><a href="#" onclick="showCategory('olahraga')" class="hover:text-white transition-colors py-1 block">Olahraga</a></li>
                            <li><a href="#" onclick="showCategory('teknologi')" class="hover:text-white transition-colors py-1 block">Teknologi</a></li>
                            <li><a href="#" onclick="showCategory('hiburan')" class="hover:text-white transition-colors py-1 block">Hiburan</a></li>
                            <li><a href="#" onclick="showCategory('pendidikan')" class="hover:text-white transition-colors py-1 block">Pendidikan</a></li>
                        </ul>
                    </div>
                    
                    <div class="text-left">
                        <h4 class="font-bold mb-3 sm:mb-4 text-sm sm:text-base">Layanan</h4>
                        <ul class="space-y-1 sm:space-y-2 text-xs sm:text-sm text-gray-300">
                            <li><a href="#" class="hover:text-white transition-colors py-1 block">Tentang Kami</a></li>
                            <li><a href="#" class="hover:text-white transition-colors py-1 block">Box Redaksi</a></li>
                            <li><a href="#" class="hover:text-white transition-colors py-1 block">Kontak Kami</a></li>
                            <li><a href="#" class="hover:text-white transition-colors py-1 block">Pedoman Cyber</a></li>
                            <li><a href="#" class="hover:text-white transition-colors py-1 block">SOP Wartawan</a></li>
                            <li><a href="#" class="hover:text-white transition-colors py-1 block">Kode Etik</a></li>
                            <li><a href="#" class="hover:text-white transition-colors py-1 block">Iklan</a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="font-bold mb-3 sm:mb-4 text-sm sm:text-base">Kontak</h4>
                        <div class="space-y-2 sm:space-y-3 text-xs sm:text-sm text-gray-300">
                            <p class="flex items-start"><i class="fas fa-map-marker-alt mr-2 mt-1 flex-shrink-0"></i><span>Jakarta, Indonesia</span></p>
                            <p class="flex items-center"><i class="fas fa-phone mr-2 flex-shrink-0"></i><span>+62 21 1234 5678</span></p>
                            <p class="flex items-start"><i class="fas fa-envelope mr-2 mt-1 flex-shrink-0"></i><span class="break-all">info@nusamedia.com</span></p>
                            <p class="flex items-start"><i class="fas fa-globe mr-2 mt-1 flex-shrink-0"></i><span class="break-all">www.nusamedia.com</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="border-t border-gray-700 mt-4 sm:mt-6 lg:mt-8 pt-4 sm:pt-6 lg:pt-8">
                    <div class="flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0">
                        <p class="text-xs sm:text-sm text-gray-400 text-center sm:text-left">&copy; 2024 NusaMedia. Semua hak dilindungi undang-undang.</p>
                        <div class="flex space-x-4 text-xs sm:text-sm text-gray-400">
                            <a href="#" class="hover:text-white transition-colors">Kebijakan Privasi</a>
                            <a href="#" class="hover:text-white transition-colors">Syarat & Ketentuan</a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Admin credentials
        const ADMIN_CREDENTIALS = {
            username: 'nusamedia-news',
            password: 'nusamedia-oke'
        };

        // Global variables
        let isLoggedIn = false;
        let selectedImages = [];
        let selectedEditImages = [];
        let adminNews = JSON.parse(localStorage.getItem('adminNews')) || [];
        let editingNewsId = null;
        
        // Google Apps Script API Configuration
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwzDQ8rmI3J3HmTPO74JRPjJSzJsnBqP_Hyjyhv94Z8SpSp4cO4NJF5K5Gui_AzHRsh/exec';
        let isOnlineMode = false;
        
        // Debug function to check configuration
        function checkConfiguration() {
            console.log('Current Google Script URL:', GOOGLE_SCRIPT_URL);
            if (GOOGLE_SCRIPT_URL.includes('YOUR_SCRIPT_ID')) {
                alert('⚠️ PENTING: Anda belum mengganti YOUR_SCRIPT_ID dengan ID Google Apps Script yang sebenarnya!\n\nSilakan ikuti langkah setup di bagian "Setup Google Sheets Database"');
                return false;
            }
            return true;
        }

        // News database
        const newsDatabase = {
            beranda: [
                {
                    title: "Pemerintah Luncurkan Program Bantuan Ekonomi Baru untuk UMKM",
                    category: "EKONOMI",
                    excerpt: "Program ini diharapkan dapat membantu pemulihan ekonomi nasional...",
                    time: "2 jam lalu",
                    views: "1.2K",
                    icon: "fas fa-chart-line",
                    gradient: "from-blue-500 to-purple-600"
                },
                {
                    title: "Indonesia Luncurkan Satelit Komunikasi Terbaru",
                    category: "TEKNOLOGI",
                    excerpt: "Satelit ini akan meningkatkan konektivitas internet di daerah terpencil...",
                    time: "1 jam lalu",
                    views: "856",
                    icon: "fas fa-laptop",
                    gradient: "from-purple-400 to-pink-500"
                },
                {
                    title: "Program Penanaman 1 Juta Pohon Dimulai",
                    category: "UMUM",
                    excerpt: "Pemerintah targetkan pengurangan emisi karbon sebesar 30%...",
                    time: "3 jam lalu",
                    views: "642",
                    icon: "fas fa-leaf",
                    gradient: "from-teal-400 to-green-500"
                },
                {
                    title: "Timnas Indonesia Lolos ke Final Piala AFF",
                    category: "OLAHRAGA",
                    excerpt: "Prestasi gemilang setelah mengalahkan Thailand 2-1...",
                    time: "4 jam lalu",
                    views: "2.8K",
                    icon: "fas fa-futbol",
                    gradient: "from-orange-400 to-red-500"
                },
                {
                    title: "Kurikulum Merdeka Diterapkan di Seluruh Indonesia",
                    category: "PENDIDIKAN",
                    excerpt: "Sistem pendidikan baru yang lebih fleksibel dan adaptif...",
                    time: "5 jam lalu",
                    views: "1.1K",
                    icon: "fas fa-graduation-cap",
                    gradient: "from-pink-400 to-purple-500"
                },
                {
                    title: "Harga Pangan Stabil Jelang Akhir Tahun",
                    category: "EKONOMI",
                    excerpt: "Pemerintah berhasil menjaga stabilitas harga kebutuhan pokok...",
                    time: "6 jam lalu",
                    views: "890",
                    icon: "fas fa-shopping-cart",
                    gradient: "from-green-400 to-teal-500"
                }
            ],
            umum: [
                {
                    title: "Program Penanaman 1 Juta Pohon Dimulai",
                    category: "UMUM",
                    excerpt: "Pemerintah targetkan pengurangan emisi karbon sebesar 30%...",
                    time: "1 jam lalu",
                    views: "1.5K",
                    icon: "fas fa-leaf",
                    gradient: "from-green-400 to-teal-500"
                },
                {
                    title: "Festival Budaya Nusantara Digelar di 34 Provinsi",
                    category: "UMUM",
                    excerpt: "Perayaan keberagaman budaya Indonesia dalam satu acara besar...",
                    time: "2 jam lalu",
                    views: "2.1K",
                    icon: "fas fa-masks-theater",
                    gradient: "from-pink-400 to-purple-500"
                },
                {
                    title: "Indonesia Raih Penghargaan Lingkungan dari PBB",
                    category: "UMUM",
                    excerpt: "Pengakuan internasional atas komitmen pelestarian lingkungan...",
                    time: "4 jam lalu",
                    views: "980",
                    icon: "fas fa-award",
                    gradient: "from-emerald-400 to-green-500"
                }
            ],
            politik: [
                {
                    title: "DPR Sahkan RUU Kesehatan Mental Nasional",
                    category: "POLITIK",
                    excerpt: "Undang-undang baru ini akan meningkatkan layanan kesehatan mental...",
                    time: "2 jam lalu",
                    views: "1.3K",
                    icon: "fas fa-gavel",
                    gradient: "from-red-400 to-pink-500"
                }
            ],
            ekonomi: [
                {
                    title: "Inflasi Indonesia Turun ke Level Terendah dalam 5 Tahun",
                    category: "EKONOMI",
                    excerpt: "Bank Indonesia optimis target inflasi 2024 tercapai...",
                    time: "1 jam lalu",
                    views: "1.8K",
                    icon: "fas fa-chart-line",
                    gradient: "from-green-400 to-blue-500"
                }
            ],
            olahraga: [
                {
                    title: "Timnas Indonesia Menang Telak 3-0 Lawan Malaysia",
                    category: "OLAHRAGA",
                    excerpt: "Kemenangan gemilang di kandang sendiri...",
                    time: "1 jam lalu",
                    views: "3.2K",
                    icon: "fas fa-futbol",
                    gradient: "from-orange-400 to-red-500"
                }
            ],
            teknologi: [
                {
                    title: "Indonesia Luncurkan Satelit Komunikasi Terbaru",
                    category: "TEKNOLOGI",
                    excerpt: "Satelit ini akan meningkatkan konektivitas internet di daerah terpencil...",
                    time: "1 jam lalu",
                    views: "1.5K",
                    icon: "fas fa-satellite",
                    gradient: "from-purple-400 to-pink-500"
                }
            ],
            hiburan: [
                {
                    title: "Film Indonesia Menang di Festival Cannes",
                    category: "HIBURAN",
                    excerpt: "Prestasi membanggakan perfilman Indonesia di kancah internasional...",
                    time: "2 jam lalu",
                    views: "2.1K",
                    icon: "fas fa-film",
                    gradient: "from-pink-400 to-rose-500"
                }
            ],
            pendidikan: [
                {
                    title: "Kurikulum Merdeka Diterapkan di Seluruh Indonesia",
                    category: "PENDIDIKAN",
                    excerpt: "Sistem pendidikan baru yang lebih fleksibel dan adaptif...",
                    time: "1 jam lalu",
                    views: "1.3K",
                    icon: "fas fa-graduation-cap",
                    gradient: "from-blue-400 to-indigo-500"
                }
            ]
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            initializeDataSource();
            
            // Check if there's a news URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const newsId = urlParams.get('id');
            const newsSlug = urlParams.get('news');
            
            if (newsId && newsSlug) {
                // Find and show the specific news article
                setTimeout(() => {
                    loadNewsData().then(allNews => {
                        const newsItem = allNews.find(n => n.id == newsId);
                        if (newsItem) {
                            showArticlePage(newsItem.title, newsId);
                        } else {
                            showAllNews();
                        }
                    });
                }, 100);
            } else {
                showAllNews();
            }
            
            updateCurrentDate();
            initializeMobileFeatures();
            updateAdminStats();
        });

        // Initialize data source (Google Sheets or localStorage)
        async function initializeDataSource() {
            console.log('🔍 Initializing data source...');
            
            // Always load from localStorage first for instant display
            loadAdminNews();
            console.log('📱 Loaded from localStorage:', adminNews.length, 'items');
            
            // Check if Google Sheets is configured
            if (GOOGLE_SCRIPT_URL.includes('YOUR_SCRIPT_ID')) {
                console.log('⚠️ Google Script URL not configured - using offline mode only');
                isOnlineMode = false;
                updateConnectionStatus();
                return;
            }
            
            try {
                console.log('🔍 Testing connection to:', GOOGLE_SCRIPT_URL);
                
                // Test connection to Google Apps Script with timeout
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000); // 8 second timeout
                
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=test', {
                    method: 'GET',
                    mode: 'cors',
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                clearTimeout(timeoutId);
                console.log('📡 Test response:', response.status, response.ok);
                
                if (response.ok) {
                    const testResult = await response.json();
                    console.log('✅ Google Sheets connection successful:', testResult);
                    
                    isOnlineMode = true;
                    console.log('🌐 Switching to online mode');
                    
                    // Try to load from Google Sheets
                    const loadSuccess = await loadNewsFromGoogleSheets();
                    if (!loadSuccess) {
                        console.log('⚠️ Failed to load from Google Sheets, keeping localStorage data');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.log('❌ Google Sheets connection failed:', error.message);
                console.log('📱 Continuing with offline mode');
                isOnlineMode = false;
            }
            
            // Always update connection status and displays
            updateConnectionStatus();
            updateAdminStats();
            displayAdminNews();
        }

        // Load news from Google Sheets
        async function loadNewsFromGoogleSheets() {
            try {
                console.log('📥 Loading news from Google Sheets...');
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getNews', {
                    method: 'GET',
                    mode: 'cors',
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                clearTimeout(timeoutId);
                console.log('📡 Response status:', response.status, 'OK:', response.ok);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('📊 Raw data from Google Sheets:', data);
                    
                    // Validate data structure
                    if (data && Array.isArray(data.news)) {
                        // Update adminNews array
                        adminNews = data.news;
                        console.log(`✅ Loaded ${adminNews.length} news items from Google Sheets`);
                        
                        // Log each news item for debugging
                        adminNews.forEach((news, index) => {
                            console.log(`News ${index + 1}: ${news.title} (ID: ${news.id})`);
                        });
                        
                        // Sync with localStorage as backup
                        localStorage.setItem('adminNews', JSON.stringify(adminNews));
                        updateMainNewsDatabase();
                        
                        console.log('🔄 Updating displays after loading from Google Sheets...');
                        
                        // Update displays immediately
                        displayAdminNews();
                        updateAdminStats();
                        
                        // If we're on main website, refresh the news display
                        const adminDashboard = document.getElementById('adminDashboard');
                        const mainWebsite = document.getElementById('mainWebsite');
                        
                        if (adminDashboard && !adminDashboard.classList.contains('hidden')) {
                            console.log('📋 Currently in admin dashboard - displays updated');
                        } else if (mainWebsite && !mainWebsite.classList.contains('hidden')) {
                            console.log('🌐 Currently on main website - refreshing news display');
                            showAllNews();
                        }
                        
                        console.log('✅ All displays updated successfully');
                        return true;
                    } else {
                        console.error('❌ Invalid data structure from Google Sheets:', data);
                        throw new Error('Invalid data structure received from Google Sheets');
                    }
                } else {
                    const errorText = await response.text();
                    console.error('❌ Response error:', errorText);
                    throw new Error(`Failed to load from Google Sheets: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                console.error('💥 Error loading from Google Sheets:', error);
                
                if (error.name === 'AbortError') {
                    console.error('⏰ Request timed out while loading from Google Sheets');
                } else if (error.message.includes('Failed to fetch')) {
                    console.error('🌐 Network error while loading from Google Sheets');
                }
                
                // Fallback to localStorage
                console.log('📱 Falling back to localStorage...');
                loadAdminNews();
                return false;
            }
        }

        // Save news to Google Sheets
        async function saveNewsToGoogleSheets(newsData) {
            if (!isOnlineMode) {
                console.log('📱 Offline mode - skipping Google Sheets save');
                return false;
            }
            
            try {
                console.log('💾 Saving to Google Sheets:', newsData.title);
                
                // Prepare clean data for Google Sheets
                const cleanData = {
                    id: newsData.id,
                    title: newsData.title,
                    category: newsData.category,
                    author: newsData.author || 'Tim Redaksi',
                    excerpt: newsData.excerpt || '',
                    content: newsData.content || '',
                    images: newsData.images || [],
                    date: newsData.date || new Date().toISOString(),
                    time: newsData.time || 'Baru saja',
                    views: newsData.views || '0'
                };
                
                console.log('📊 Sending data:', {
                    id: cleanData.id,
                    title: cleanData.title,
                    category: cleanData.category,
                    imagesCount: cleanData.images.length
                });
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 20000); // 20 second timeout
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    signal: controller.signal,
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'addNews',
                        data: cleanData
                    })
                });
                
                clearTimeout(timeoutId);
                console.log('📡 Response:', response.status, response.statusText);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('📋 Result:', result);
                    
                    if (result.success) {
                        console.log('✅ Successfully saved to Google Sheets');
                        return true;
                    } else {
                        console.error('❌ Google Sheets error:', result.error);
                        throw new Error(result.error || 'Google Sheets returned success: false');
                    }
                } else {
                    const errorText = await response.text();
                    console.error('❌ HTTP Error:', response.status, errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
            } catch (error) {
                console.error('💥 Save error:', error.message);
                
                if (error.name === 'AbortError') {
                    console.error('⏰ Request timeout (20 seconds)');
                } else if (error.message.includes('Failed to fetch')) {
                    console.error('🌐 Network/CORS error');
                } else if (error.message.includes('NetworkError')) {
                    console.error('🌐 Network connection failed');
                }
                
                return false;
            }
        }

        // Update news in Google Sheets
        async function updateNewsInGoogleSheets(newsId, newsData) {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateNews',
                        id: newsId,
                        data: newsData
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    return result.success;
                } else {
                    throw new Error('Failed to update in Google Sheets');
                }
            } catch (error) {
                console.error('Error updating in Google Sheets:', error);
                return false;
            }
        }

        // Delete news from Google Sheets
        async function deleteNewsFromGoogleSheets(newsId) {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'deleteNews',
                        id: newsId
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    return result.success;
                } else {
                    throw new Error('Failed to delete from Google Sheets');
                }
            } catch (error) {
                console.error('Error deleting from Google Sheets:', error);
                return false;
            }
        }

        // Load news data (from Google Sheets or localStorage)
        async function loadNewsData() {
            if (isOnlineMode) {
                await loadNewsFromGoogleSheets();
            } else {
                loadAdminNews();
            }
            
            // Combine with default news
            const allNews = [...adminNews, ...Object.values(newsDatabase).flat()];
            return allNews.filter((news, index, self) => 
                index === self.findIndex(n => n.title === news.title)
            );
        }

        // Load admin news and update main database
        function loadAdminNews() {
            adminNews = JSON.parse(localStorage.getItem('adminNews')) || [];
            updateMainNewsDatabase();
        }

        // Check login status
        function checkLoginStatus() {
            isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
            if (isLoggedIn) {
                showAdminDashboard();
            }
        }

        // Login functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginError').classList.add('hidden');
        }

        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isLoggedIn = true;
                localStorage.setItem('adminLoggedIn', 'true');
                closeLoginModal();
                showAdminDashboard();
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
            } else {
                document.getElementById('loginError').textContent = 'Username atau password salah!';
                document.getElementById('loginError').classList.remove('hidden');
            }
        }

        function logout() {
            isLoggedIn = false;
            localStorage.removeItem('adminLoggedIn');
            showMainSite();
        }

        // Navigation functions
        function showAdminDashboard() {
            document.getElementById('mainWebsite').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            updateConnectionStatus();
            updateAdminStats();
            displayAdminNews();
        }

        function showMainSite() {
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('mainWebsite').classList.remove('hidden');
            showAllNews();
        }

        // Image preview functions
        function previewImages() {
            const files = document.getElementById('newsImages').files;
            const previewContainer = document.getElementById('imagePreview');
            
            if (files.length > 4) {
                alert('Maksimal 4 foto yang dapat diupload!');
                document.getElementById('newsImages').value = '';
                return;
            }
            
            selectedImages = [];
            previewContainer.innerHTML = '';
            
            Array.from(files).forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    selectedImages.push(e.target.result);
                    
                    const imageDiv = document.createElement('div');
                    imageDiv.className = 'image-preview';
                    imageDiv.innerHTML = `
                        <img src="${e.target.result}" alt="Preview ${index + 1}">
                        <button type="button" class="remove-image" onclick="removeImage(${index})">×</button>
                    `;
                    previewContainer.appendChild(imageDiv);
                };
                reader.readAsDataURL(file);
            });
        }

        function previewEditImages() {
            const files = document.getElementById('editNewsImages').files;
            const previewContainer = document.getElementById('editImagePreview');
            
            if (files.length > 4) {
                alert('Maksimal 4 foto yang dapat diupload!');
                document.getElementById('editNewsImages').value = '';
                return;
            }
            
            selectedEditImages = [];
            previewContainer.innerHTML = '';
            
            Array.from(files).forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    selectedEditImages.push(e.target.result);
                    
                    const imageDiv = document.createElement('div');
                    imageDiv.className = 'image-preview';
                    imageDiv.innerHTML = `
                        <img src="${e.target.result}" alt="Preview ${index + 1}">
                        <button type="button" class="remove-image" onclick="removeEditImage(${index})">×</button>
                    `;
                    previewContainer.appendChild(imageDiv);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeImage(index) {
            selectedImages.splice(index, 1);
            const previewContainer = document.getElementById('imagePreview');
            previewContainer.children[index].remove();
            
            // Update file input
            const dt = new DataTransfer();
            const files = document.getElementById('newsImages').files;
            for (let i = 0; i < files.length; i++) {
                if (i !== index) {
                    dt.items.add(files[i]);
                }
            }
            document.getElementById('newsImages').files = dt.files;
        }

        function removeEditImage(index) {
            selectedEditImages.splice(index, 1);
            const previewContainer = document.getElementById('editImagePreview');
            previewContainer.children[index].remove();
            
            // Update file input
            const dt = new DataTransfer();
            const files = document.getElementById('editNewsImages').files;
            for (let i = 0; i < files.length; i++) {
                if (i !== index) {
                    dt.items.add(files[i]);
                }
            }
            document.getElementById('editNewsImages').files = dt.files;
        }

        // Add news function
        async function addNews(event) {
            event.preventDefault();
            
            const title = document.getElementById('newsTitle').value.trim();
            const category = document.getElementById('newsCategory').value;
            const author = document.getElementById('newsAuthor').value.trim() || 'Tim Redaksi';
            const excerpt = document.getElementById('newsExcerpt').value.trim() || title.substring(0, 100) + '...';
            const content = document.getElementById('newsContent').value.trim();
            
            // Validation
            if (!title || !category || !content) {
                alert('❌ Mohon lengkapi semua field yang wajib diisi!');
                return;
            }
            
            const newNews = {
                id: Date.now(),
                title: title,
                category: category.toUpperCase(),
                excerpt: excerpt,
                content: content,
                author: author,
                time: 'Baru saja',
                views: '0',
                images: [...selectedImages], // Create copy of array
                date: new Date().toISOString(),
                icon: getCategoryIcon(category),
                gradient: getCategoryGradient(category)
            };
            
            // Show loading state
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...';
            submitBtn.disabled = true;
            
            try {
                console.log('📝 Adding news:', newNews.title);
                console.log('📊 News data:', {
                    id: newNews.id,
                    title: newNews.title,
                    category: newNews.category,
                    contentLength: newNews.content.length,
                    imagesCount: newNews.images.length
                });
                
                // Step 1: Always save to localStorage first (instant display)
                adminNews.unshift(newNews);
                localStorage.setItem('adminNews', JSON.stringify(adminNews));
                console.log('💾 ✅ Saved to localStorage');
                
                // Step 2: Update displays immediately
                updateMainNewsDatabase();
                displayAdminNews();
                updateAdminStats();
                
                // Update main website if visible
                const mainWebsite = document.getElementById('mainWebsite');
                if (mainWebsite && !mainWebsite.classList.contains('hidden')) {
                    showAllNews();
                }
                
                // Step 3: Try Google Sheets if online
                let syncMessage = '';
                if (isOnlineMode) {
                    console.log('☁️ Attempting Google Sheets sync...');
                    localStorage.setItem('lastSyncAttempt', new Date().toISOString());
                    
                    const syncSuccess = await saveNewsToGoogleSheets(newNews);
                    
                    if (syncSuccess) {
                        console.log('✅ Google Sheets sync successful');
                        localStorage.setItem('lastSuccessfulSync', new Date().toISOString());
                        syncMessage = '✅ Berita berhasil ditambahkan dan disinkronkan ke Google Sheets!';
                        
                        // Optional: Reload from Google Sheets after delay
                        setTimeout(async () => {
                            console.log('🔄 Refreshing from Google Sheets...');
                            await loadNewsFromGoogleSheets();
                            displayAdminNews();
                            updateAdminStats();
                        }, 2000);
                    } else {
                        console.log('❌ Google Sheets sync failed');
                        syncMessage = '⚠️ Berita berhasil ditambahkan secara lokal.\nGunakan tombol "Sinkronisasi" untuk upload ke Google Sheets.';
                    }
                } else {
                    console.log('📱 Offline mode - localStorage only');
                    syncMessage = '📱 Berita berhasil ditambahkan (mode offline)!\n\nGunakan tombol "Sinkronisasi" untuk upload ke Google Sheets saat koneksi tersedia.';
                }
                
                // Step 4: Show success message and reset form
                alert(syncMessage);
                resetForm();
                
                console.log('✅ Add news completed successfully');
                
            } catch (error) {
                console.error('💥 Error in addNews:', error);
                
                // Ensure news is saved locally even if there's an error
                const existingIndex = adminNews.findIndex(n => n.id === newNews.id);
                if (existingIndex === -1) {
                    adminNews.unshift(newNews);
                    localStorage.setItem('adminNews', JSON.stringify(adminNews));
                    console.log('🔧 Fallback: Saved to localStorage');
                }
                
                updateMainNewsDatabase();
                displayAdminNews();
                updateAdminStats();
                
                // Update main website if visible
                const mainWebsite = document.getElementById('mainWebsite');
                if (mainWebsite && !mainWebsite.classList.contains('hidden')) {
                    showAllNews();
                }
                
                alert('⚠️ Berita berhasil disimpan secara lokal.\nGunakan tombol "Sinkronisasi" untuk upload ke Google Sheets.');
                resetForm();
                
            } finally {
                // Always restore button state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        function getCategoryIcon(category) {
            const icons = {
                'umum': 'fas fa-newspaper',
                'politik': 'fas fa-gavel',
                'ekonomi': 'fas fa-chart-line',
                'olahraga': 'fas fa-futbol',
                'teknologi': 'fas fa-laptop',
                'hiburan': 'fas fa-film',
                'pendidikan': 'fas fa-graduation-cap'
            };
            return icons[category] || 'fas fa-newspaper';
        }

        function getCategoryGradient(category) {
            const gradients = {
                'umum': 'from-green-400 to-teal-500',
                'politik': 'from-red-400 to-pink-500',
                'ekonomi': 'from-blue-400 to-indigo-500',
                'olahraga': 'from-orange-400 to-red-500',
                'teknologi': 'from-purple-400 to-pink-500',
                'hiburan': 'from-pink-400 to-rose-500',
                'pendidikan': 'from-blue-400 to-indigo-500'
            };
            return gradients[category] || 'from-gray-400 to-gray-500';
        }

        function resetForm() {
            document.getElementById('newsTitle').value = '';
            document.getElementById('newsCategory').value = '';
            document.getElementById('newsAuthor').value = 'Tim Redaksi';
            document.getElementById('newsExcerpt').value = '';
            document.getElementById('newsContent').value = '';
            document.getElementById('newsImages').value = '';
            document.getElementById('imagePreview').innerHTML = '';
            selectedImages = [];
        }

        // Update admin stats
        function updateAdminStats() {
            const totalNews = adminNews.length + Object.values(newsDatabase).flat().length;
            const totalViews = adminNews.reduce((sum, news) => sum + parseInt(news.views.replace('K', '000').replace('.', '')), 0) + 15000;
            const today = new Date().toDateString();
            const todayNews = adminNews.filter(news => new Date(news.date).toDateString() === today).length;
            
            document.getElementById('totalNews').textContent = totalNews;
            document.getElementById('totalViews').textContent = Math.floor(totalViews / 1000) + 'K';
            document.getElementById('todayNews').textContent = todayNews;
        }

        // Display admin news
        function displayAdminNews() {
            console.log('📋 Displaying admin news...');
            const container = document.getElementById('adminNewsList');
            
            if (!container) {
                console.log('❌ Admin news container not found');
                return;
            }
            
            // Get all news (admin + default) for editing
            const allEditableNews = [...adminNews];
            console.log(`📊 Admin news count: ${adminNews.length}`);
            
            // Add default news with unique IDs for editing
            Object.values(newsDatabase).flat().forEach(news => {
                if (!news.id) {
                    news.id = 'default_' + Math.random().toString(36).substr(2, 9);
                    news.isDefault = true;
                }
                if (!allEditableNews.find(n => n.title === news.title)) {
                    allEditableNews.push(news);
                }
            });
            
            console.log(`📊 Total editable news: ${allEditableNews.length}`);
            
            if (allEditableNews.length === 0) {
                console.log('📝 No news to display');
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada berita yang ditambahkan.</p>';
                return;
            }
            
            console.log('🎨 Rendering news list...');
            container.innerHTML = allEditableNews.map((news, index) => {
                console.log(`Rendering news ${index + 1}: ${news.title}`);
                return `
                <div class="border rounded-lg p-4 hover:bg-gray-50">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">${news.category}</span>
                                <span class="text-gray-500 text-sm">${news.time}</span>
                                ${news.isDefault ? '<span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs">Default</span>' : '<span class="bg-green-100 text-green-600 px-2 py-1 rounded text-xs">Custom</span>'}
                            </div>
                            <h3 class="font-bold text-lg mb-2">${news.title}</h3>
                            <p class="text-gray-600 text-sm mb-2">${news.excerpt}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center text-gray-500 text-sm">
                                    <i class="far fa-user mr-1"></i>
                                    <span>${news.author || 'Tim Redaksi'}</span>
                                    <i class="far fa-eye ml-4 mr-1"></i>
                                    <span>${news.views} views</span>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="editNews('${news.id}')" class="bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600">
                                        <i class="fas fa-edit mr-1"></i>Edit
                                    </button>
                                    <button onclick="deleteNews('${news.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                                        <i class="fas fa-trash mr-1"></i>Hapus
                                    </button>
                                </div>
                            </div>
                        </div>
                        ${news.images && news.images.length > 0 ? `
                            <div class="ml-4">
                                <div class="w-20 h-20">
                                    <img src="${news.images[0]}" alt="News image" class="w-full h-full object-cover rounded">
                                </div>
                                ${news.images.length > 1 ? `<span class="text-xs text-gray-500 block text-center mt-1">+${news.images.length - 1} foto</span>` : ''}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            }).join('');
            
            console.log('✅ Admin news display completed');
        }

        // Edit news function
        function editNews(newsId) {
            let news = adminNews.find(n => n.id == newsId);
            
            // If not found in admin news, search in default news
            if (!news) {
                const allNews = Object.values(newsDatabase).flat();
                news = allNews.find(n => n.id == newsId);
            }
            
            if (!news) return;
            
            editingNewsId = newsId;
            
            // Fill form with existing data
            document.getElementById('editNewsId').value = newsId;
            document.getElementById('editNewsTitle').value = news.title;
            document.getElementById('editNewsCategory').value = news.category.toLowerCase();
            document.getElementById('editNewsAuthor').value = news.author || 'Tim Redaksi';
            document.getElementById('editNewsExcerpt').value = news.excerpt;
            document.getElementById('editNewsContent').value = news.content || generateDefaultContent(news.title, news.excerpt);
            
            // Show existing images
            const previewContainer = document.getElementById('editImagePreview');
            previewContainer.innerHTML = '';
            if (news.images && news.images.length > 0) {
                news.images.forEach((img, index) => {
                    const imageDiv = document.createElement('div');
                    imageDiv.className = 'image-preview';
                    imageDiv.innerHTML = `
                        <img src="${img}" alt="Current image ${index + 1}">
                        <span class="text-xs text-gray-500 block text-center mt-1">Foto saat ini</span>
                    `;
                    previewContainer.appendChild(imageDiv);
                });
            }
            
            // Show modal
            document.getElementById('editModal').classList.remove('hidden');
        }

        // Generate default content for news without content
        function generateDefaultContent(title, excerpt) {
            return `Jakarta - ${title} menjadi sorotan utama hari ini. ${excerpt}

Berbagai pihak memberikan respons positif terhadap perkembangan ini yang diharapkan dapat membawa dampak baik bagi masyarakat Indonesia.

Menurut sumber terpercaya, langkah ini merupakan bagian dari upaya berkelanjutan untuk meningkatkan kesejahteraan rakyat. Implementasi kebijakan ini akan dilakukan secara bertahap dengan melibatkan berbagai stakeholder terkait.

"Kami berkomitmen untuk terus memberikan yang terbaik bagi bangsa dan negara," ujar salah satu pejabat terkait dalam konferensi pers yang diselenggarakan hari ini.

Ke depannya, diharapkan inisiatif ini dapat menjadi contoh baik dan dapat direplikasi di berbagai daerah lainnya untuk mencapai tujuan pembangunan nasional yang berkelanjutan.`;
        }

        // Update news function
        async function updateNews(event) {
            event.preventDefault();
            
            const newsId = document.getElementById('editNewsId').value;
            const title = document.getElementById('editNewsTitle').value;
            const category = document.getElementById('editNewsCategory').value;
            const author = document.getElementById('editNewsAuthor').value || 'Tim Redaksi';
            const excerpt = document.getElementById('editNewsExcerpt').value || title.substring(0, 100) + '...';
            const content = document.getElementById('editNewsContent').value;
            
            // Show loading state
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...';
            submitBtn.disabled = true;
            
            try {
                console.log('✏️ Updating news:', title, 'ID:', newsId);
                console.log('🌐 Online mode:', isOnlineMode);
                
                // Check if it's an admin news or default news
                const adminNewsIndex = adminNews.findIndex(n => n.id == newsId);
                console.log('📍 Admin news index:', adminNewsIndex);
                
                let updatedNews;
                if (adminNewsIndex !== -1) {
                    // Update existing admin news
                    updatedNews = {
                        ...adminNews[adminNewsIndex],
                        title: title,
                        category: category.toUpperCase(),
                        author: author,
                        excerpt: excerpt,
                        content: content,
                        images: selectedEditImages.length > 0 ? selectedEditImages : adminNews[adminNewsIndex].images,
                        icon: getCategoryIcon(category),
                        gradient: getCategoryGradient(category)
                    };
                    console.log('🔄 Updating existing admin news');
                } else {
                    // Convert default news to admin news
                    updatedNews = {
                        id: Date.now(), // New ID for converted news
                        title: title,
                        category: category.toUpperCase(),
                        author: author,
                        excerpt: excerpt,
                        content: content,
                        time: 'Baru saja',
                        views: '0',
                        images: selectedEditImages.length > 0 ? selectedEditImages : [],
                        date: new Date().toISOString(),
                        icon: getCategoryIcon(category),
                        gradient: getCategoryGradient(category)
                    };
                    console.log('🆕 Converting default news to admin news');
                }
                
                // Always update localStorage first for instant display
                if (adminNewsIndex !== -1) {
                    adminNews[adminNewsIndex] = updatedNews;
                } else {
                    adminNews.unshift(updatedNews);
                    // Remove from default database to avoid duplicates
                    Object.keys(newsDatabase).forEach(cat => {
                        newsDatabase[cat] = newsDatabase[cat].filter(n => n.id != newsId);
                    });
                }
                localStorage.setItem('adminNews', JSON.stringify(adminNews));
                console.log('💾 Updated in localStorage');
                
                if (isOnlineMode) {
                    console.log('☁️ Attempting to update in Google Sheets...');
                    
                    // For converted news, use addNews instead of updateNews
                    let success;
                    if (adminNewsIndex !== -1) {
                        success = await updateNewsInGoogleSheets(newsId, updatedNews);
                    } else {
                        success = await saveNewsToGoogleSheets(updatedNews);
                    }
                    
                    if (success) {
                        console.log('✅ Successfully updated in Google Sheets');
                        
                        // Sync back from Google Sheets after a delay
                        setTimeout(async () => {
                            console.log('🔄 Reloading from Google Sheets...');
                            await loadNewsFromGoogleSheets();
                            displayAdminNews();
                            updateAdminStats();
                        }, 1000);
                        
                        alert('✅ Berita berhasil diperbarui dan disinkronkan ke Google Sheets!');
                    } else {
                        console.log('❌ Failed to update in Google Sheets');
                        alert('⚠️ Berita diperbarui secara lokal. Gunakan tombol Sinkronisasi untuk upload ke Google Sheets.');
                    }
                } else {
                    console.log('📱 Offline mode - updated in localStorage only');
                    updateMainNewsDatabase();
                    alert('📱 Berita berhasil diperbarui (mode offline)!\n\nGunakan tombol Sinkronisasi untuk upload ke Google Sheets saat koneksi tersedia.');
                }
                
                closeEditModal();
                displayAdminNews();
                updateAdminStats();
                
                // Update main website display if visible
                const mainWebsite = document.getElementById('mainWebsite');
                if (mainWebsite && !mainWebsite.classList.contains('hidden')) {
                    showAllNews();
                }
                
            } catch (error) {
                console.error('💥 Error updating news:', error);
                
                // Ensure news is updated locally even if there's an error
                if (adminNewsIndex !== -1) {
                    adminNews[adminNewsIndex] = updatedNews;
                } else {
                    adminNews.unshift(updatedNews);
                    Object.keys(newsDatabase).forEach(cat => {
                        newsDatabase[cat] = newsDatabase[cat].filter(n => n.id != newsId);
                    });
                }
                localStorage.setItem('adminNews', JSON.stringify(adminNews));
                updateMainNewsDatabase();
                alert('⚠️ Berita diperbarui secara lokal. Gunakan tombol Sinkronisasi untuk upload ke Google Sheets.');
                
                closeEditModal();
                displayAdminNews();
                updateAdminStats();
                
                // Update main website display if visible
                const mainWebsite = document.getElementById('mainWebsite');
                if (mainWebsite && !mainWebsite.classList.contains('hidden')) {
                    showAllNews();
                }
            } finally {
                // Restore button state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // Delete news function
        async function deleteNews(newsId) {
            if (confirm('Apakah Anda yakin ingin menghapus berita ini?')) {
                try {
                    if (isOnlineMode) {
                        // Delete from Google Sheets
                        const success = await deleteNewsFromGoogleSheets(newsId);
                        if (success) {
                            // Reload from Google Sheets to get updated data
                            await loadNewsFromGoogleSheets();
                            alert('Berita berhasil dihapus dan disinkronkan ke Google Sheets!');
                        } else {
                            throw new Error('Failed to delete from Google Sheets');
                        }
                    } else {
                        // Delete from localStorage
                        adminNews = adminNews.filter(n => n.id != newsId);
                        localStorage.setItem('adminNews', JSON.stringify(adminNews));
                        
                        // Remove from default database if it exists there
                        Object.keys(newsDatabase).forEach(cat => {
                            newsDatabase[cat] = newsDatabase[cat].filter(n => n.id != newsId);
                        });
                        
                        updateMainNewsDatabase();
                        alert('Berita berhasil dihapus (mode offline)!');
                    }
                    
                    displayAdminNews();
                    updateAdminStats();
                    
                } catch (error) {
                    console.error('Error deleting news:', error);
                    // Fallback to localStorage
                    adminNews = adminNews.filter(n => n.id != newsId);
                    localStorage.setItem('adminNews', JSON.stringify(adminNews));
                    
                    Object.keys(newsDatabase).forEach(cat => {
                        newsDatabase[cat] = newsDatabase[cat].filter(n => n.id != newsId);
                    });
                    
                    updateMainNewsDatabase();
                    alert('Berita dihapus secara lokal. Akan disinkronkan saat koneksi tersedia.');
                    
                    displayAdminNews();
                    updateAdminStats();
                }
            }
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            selectedEditImages = [];
            editingNewsId = null;
            document.getElementById('editNewsImages').value = '';
            document.getElementById('editImagePreview').innerHTML = '';
        }

        // Update main news database with admin news
        function updateMainNewsDatabase() {
            // Clear all admin news from categories first
            Object.keys(newsDatabase).forEach(category => {
                newsDatabase[category] = newsDatabase[category].filter(news => 
                    !news.id || 
                    (typeof news.id === 'string' && news.id.startsWith('default_')) || 
                    news.id < 1000000000000
                );
            });
            
            // Don't add admin news to category databases - they'll be merged during display
            // This prevents duplicates in the database itself
        }

        // Initialize mobile features
        function initializeMobileFeatures() {
            // Mobile menu toggle
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileNav = document.getElementById('mobileNav');
            
            if (mobileMenuBtn && mobileNav) {
                mobileMenuBtn.addEventListener('click', function() {
                    mobileNav.classList.toggle('hidden');
                });
            }

            // Mobile search toggle
            const mobileSearchBtn = document.getElementById('mobileSearchBtn');
            const mobileSearchBar = document.getElementById('mobileSearchBar');
            
            if (mobileSearchBtn && mobileSearchBar) {
                mobileSearchBtn.addEventListener('click', function() {
                    mobileSearchBar.classList.toggle('hidden');
                    if (!mobileSearchBar.classList.contains('hidden')) {
                        document.getElementById('mobileSearchInput').focus();
                    }
                });
            }

            // Mobile search input
            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performMobileSearch();
                    }
                });
            }
        }

        // Mobile search function
        window.performMobileSearch = function() {
            const searchTerm = document.getElementById('mobileSearchInput').value.trim().toLowerCase();
            if (searchTerm) {
                // Search through all categories including admin news
                const allNews = [...adminNews, ...Object.values(newsDatabase).flat()];
                
                // Remove duplicates first, then search
                const uniqueAllNews = allNews.filter((news, index, self) => 
                    index === self.findIndex(n => n.title === news.title)
                );
                
                const searchResults = uniqueAllNews.filter(news => 
                    news.title.toLowerCase().includes(searchTerm) || 
                    news.excerpt.toLowerCase().includes(searchTerm) ||
                    news.category.toLowerCase().includes(searchTerm)
                );

                displayNews(searchResults, `Hasil Pencarian: "${searchTerm}"`);
                updateActiveNav('search');
                
                // Clear search input and hide search bar
                document.getElementById('mobileSearchInput').value = '';
                document.getElementById('mobileSearchBar').classList.add('hidden');
            } else {
                alert('Masukkan kata kunci pencarian!');
            }
        }

        // Function to update current date
        function updateCurrentDate() {
            const now = new Date();
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                           'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            const dayName = days[now.getDay()];
            const date = now.getDate();
            const month = months[now.getMonth()];
            const year = now.getFullYear();
            
            const formattedDate = `${dayName}, ${date} ${month} ${year}`;
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                dateElement.textContent = formattedDate;
            }
        }

        // Update date every minute
        setInterval(updateCurrentDate, 60000);

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        }

        // Search function
        window.performSearch = function() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            if (searchTerm) {
                // Search through all categories including admin news
                const allNews = [...adminNews, ...Object.values(newsDatabase).flat()];
                
                // Remove duplicates first, then search
                const uniqueAllNews = allNews.filter((news, index, self) => 
                    index === self.findIndex(n => n.title === news.title)
                );
                
                const searchResults = uniqueAllNews.filter(news => 
                    news.title.toLowerCase().includes(searchTerm) || 
                    news.excerpt.toLowerCase().includes(searchTerm) ||
                    news.category.toLowerCase().includes(searchTerm)
                );

                displayNews(searchResults, `Hasil Pencarian: "${searchTerm}"`);
                updateActiveNav('search');
                
                // Clear search input
                document.getElementById('searchInput').value = '';
            } else {
                alert('Masukkan kata kunci pencarian!');
            }
        }

        // Category navigation function
        window.showCategory = function(category) {
            event.preventDefault();
            updateActiveNav(category);
            
            if (category === 'beranda') {
                showAllNews();
            } else {
                const categoryNews = [...(newsDatabase[category] || [])];
                // Add admin news for this category
                const adminCategoryNews = adminNews.filter(news => news.category.toLowerCase() === category);
                
                // Merge and remove duplicates based on title
                const allCategoryNews = [...adminCategoryNews, ...categoryNews];
                const uniqueNews = allCategoryNews.filter((news, index, self) => 
                    index === self.findIndex(n => n.title === news.title)
                );
                
                const categoryNames = {
                    'umum': 'Umum',
                    'politik': 'Politik',
                    'ekonomi': 'Ekonomi',
                    'olahraga': 'Olahraga',
                    'teknologi': 'Teknologi',
                    'hiburan': 'Hiburan',
                    'pendidikan': 'Pendidikan'
                };
                displayNews(uniqueNews, `Berita ${categoryNames[category]}`);
            }
        }

        // Show all news (beranda)
        window.showAllNews = async function() {
            const allNews = await loadNewsData();
            displayNews(allNews, 'Berita Terkini');
            updateActiveNav('beranda');
        }

        // Update connection status
        function updateConnectionStatus() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (statusDot && statusText) {
                if (isOnlineMode) {
                    statusDot.className = 'w-2 h-2 rounded-full mr-1 bg-green-500';
                    statusText.textContent = 'Google Sheets';
                    statusText.className = 'text-green-600';
                } else {
                    statusDot.className = 'w-2 h-2 rounded-full mr-1 bg-yellow-500';
                    statusText.textContent = 'Offline Mode';
                    statusText.className = 'text-yellow-600';
                }
            }
            
            // Update debug information
            updateDebugInfo();
        }
        
        // Update debug information
        function updateDebugInfo() {
            const currentScriptUrl = document.getElementById('currentScriptUrl');
            const debugConnectionStatus = document.getElementById('debugConnectionStatus');
            const debugLocalNewsCount = document.getElementById('debugLocalNewsCount');
            const debugLastSync = document.getElementById('debugLastSync');
            
            if (currentScriptUrl) {
                currentScriptUrl.textContent = GOOGLE_SCRIPT_URL;
                if (GOOGLE_SCRIPT_URL.includes('YOUR_SCRIPT_ID')) {
                    currentScriptUrl.className = 'font-mono bg-red-100 p-2 rounded mt-1 break-all text-red-600';
                } else {
                    currentScriptUrl.className = 'font-mono bg-white p-2 rounded mt-1 break-all';
                }
            }
            
            if (debugConnectionStatus) {
                debugConnectionStatus.textContent = isOnlineMode ? 
                    '✅ Online - Connected to Google Sheets' : 
                    '📱 Offline - Using localStorage only';
            }
            
            if (debugLocalNewsCount) {
                const localCount = JSON.parse(localStorage.getItem('adminNews') || '[]').length;
                debugLocalNewsCount.textContent = `${localCount} berita tersimpan lokal`;
            }
            
            if (debugLastSync) {
                const lastSync = localStorage.getItem('lastSyncAttempt');
                if (lastSync) {
                    debugLastSync.textContent = new Date(lastSync).toLocaleString('id-ID');
                } else {
                    debugLastSync.textContent = 'Belum pernah sync';
                }
            }
        }

        // Manual sync function
        window.syncData = async function() {
            // Check if configuration is complete
            if (!checkConfiguration()) {
                return;
            }
            
            const syncBtn = document.getElementById('syncBtn');
            const originalText = syncBtn.innerHTML;
            
            syncBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Sinkronisasi...';
            syncBtn.disabled = true;
            
            try {
                console.log('🔄 Starting manual synchronization...');
                console.log('🔗 Testing connection to:', GOOGLE_SCRIPT_URL);
                
                // Test connection first
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 12000); // 12 second timeout
                
                const testResponse = await fetch(GOOGLE_SCRIPT_URL + '?action=test', {
                    method: 'GET',
                    mode: 'cors',
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                clearTimeout(timeoutId);
                console.log('📡 Test response:', testResponse.status, testResponse.ok);
                
                if (!testResponse.ok) {
                    throw new Error(`Connection test failed: HTTP ${testResponse.status}`);
                }
                
                const testData = await testResponse.json();
                console.log('✅ Connection test successful:', testData);
                
                // Switch to online mode
                isOnlineMode = true;
                updateConnectionStatus();
                
                // Get local news to sync
                const localNews = JSON.parse(localStorage.getItem('adminNews')) || [];
                console.log('📊 Local news to sync:', localNews.length);
                
                let syncResults = {
                    total: localNews.length,
                    success: 0,
                    failed: 0,
                    errors: []
                };
                
                // Sync each news item
                if (localNews.length > 0) {
                    console.log('📤 Starting batch upload to Google Sheets...');
                    
                    for (let i = 0; i < localNews.length; i++) {
                        const news = localNews[i];
                        console.log(`📝 Syncing ${i + 1}/${localNews.length}: ${news.title}`);
                        
                        try {
                            const syncSuccess = await saveNewsToGoogleSheets(news);
                            
                            if (syncSuccess) {
                                syncResults.success++;
                                console.log(`✅ Successfully synced: ${news.title}`);
                            } else {
                                syncResults.failed++;
                                syncResults.errors.push(`Failed to sync: ${news.title}`);
                                console.log(`❌ Failed to sync: ${news.title}`);
                            }
                            
                            // Rate limiting: delay between requests
                            if (i < localNews.length - 1) {
                                console.log('⏳ Waiting 1 second before next sync...');
                                await new Promise(resolve => setTimeout(resolve, 1000));
                            }
                            
                        } catch (error) {
                            syncResults.failed++;
                            syncResults.errors.push(`Error syncing ${news.title}: ${error.message}`);
                            console.error(`💥 Error syncing ${news.title}:`, error);
                        }
                    }
                    
                    console.log('📊 Sync results:', syncResults);
                } else {
                    console.log('📝 No local news to sync');
                }
                
                // Load fresh data from Google Sheets
                console.log('📥 Loading updated data from Google Sheets...');
                const loadSuccess = await loadNewsFromGoogleSheets();
                
                if (loadSuccess) {
                    console.log('✅ Successfully reloaded from Google Sheets');
                } else {
                    console.log('⚠️ Failed to reload from Google Sheets');
                }
                
                // Update all displays
                console.log('🔄 Updating all displays...');
                displayAdminNews();
                updateAdminStats();
                updateConnectionStatus();
                
                // Update main website if visible
                const mainWebsite = document.getElementById('mainWebsite');
                if (mainWebsite && !mainWebsite.classList.contains('hidden')) {
                    console.log('🌐 Updating main website display...');
                    showAllNews();
                }
                
                // Show detailed success message
                let message = '✅ Sinkronisasi selesai!\n\n';
                message += `📊 Status:\n`;
                message += `• Total berita lokal: ${syncResults.total}\n`;
                message += `• Berhasil diupload: ${syncResults.success}\n`;
                message += `• Gagal diupload: ${syncResults.failed}\n`;
                message += `• Total berita di database: ${adminNews.length}\n\n`;
                
                if (syncResults.failed > 0) {
                    message += '⚠️ Beberapa berita gagal disinkronkan.\n';
                    message += 'Periksa console (F12) untuk detail error.\n\n';
                }
                
                message += '🔄 Semua tampilan telah diperbarui!';
                
                alert(message);
                console.log('✅ Manual sync completed successfully');
                
            } catch (error) {
                console.error('💥 Manual sync failed:', error);
                
                // Ensure we're still in the right mode
                isOnlineMode = false;
                updateConnectionStatus();
                
                let errorMessage = '❌ Sinkronisasi gagal!\n\n';
                
                if (error.name === 'AbortError') {
                    errorMessage += '⏰ Koneksi timeout (lebih dari 12 detik).\n\n';
                    errorMessage += 'Kemungkinan penyebab:\n';
                    errorMessage += '• Koneksi internet lambat\n';
                    errorMessage += '• Google Apps Script tidak merespons\n';
                    errorMessage += '• Server Google sedang overload';
                } else if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMessage += '🌐 Masalah koneksi atau CORS.\n\n';
                    errorMessage += 'Solusi:\n';
                    errorMessage += '1. Periksa koneksi internet\n';
                    errorMessage += '2. Pastikan Google Apps Script sudah di-deploy\n';
                    errorMessage += '3. Pastikan "Who has access" = Anyone\n';
                    errorMessage += '4. Coba refresh halaman dan sync lagi';
                } else if (error.message.includes('404')) {
                    errorMessage += '🔍 Google Apps Script tidak ditemukan.\n\n';
                    errorMessage += 'Periksa:\n';
                    errorMessage += '1. ID Script di kode sudah benar\n';
                    errorMessage += '2. Script sudah di-deploy sebagai Web App\n';
                    errorMessage += '3. URL deployment sudah benar';
                } else {
                    errorMessage += `💥 Error: ${error.message}\n\n`;
                    errorMessage += 'Buka console browser (F12) untuk detail lengkap.';
                }
                
                alert(errorMessage);
                
            } finally {
                // Always restore button state
                syncBtn.innerHTML = originalText;
                syncBtn.disabled = false;
                updateConnectionStatus();
            }
        }

        // Update active navigation
        function updateActiveNav(activeCategory) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.className = 'nav-link text-gray-700 hover:text-red-600';
            });
            
            if (activeCategory === 'beranda') {
                const berandaLink = document.querySelector('a[onclick="showCategory(\'beranda\')"]');
                if (berandaLink) {
                    berandaLink.className = 'nav-link text-red-600 hover:text-red-800';
                }
            } else if (activeCategory !== 'search' && activeCategory !== '') {
                const categoryLink = document.querySelector(`a[onclick="showCategory('${activeCategory}')"]`);
                if (categoryLink) {
                    categoryLink.className = 'nav-link text-red-600 hover:text-red-800';
                }
            }
        }

        // Display news function
        function displayNews(newsArray, sectionTitle) {
            const titleElement = document.getElementById('sectionTitle');
            const container = document.getElementById('newsContainer');
            
            if (titleElement) {
                titleElement.textContent = sectionTitle;
            }
            
            if (!container) return;
            
            if (newsArray.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-500">Tidak ada berita yang ditemukan</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = newsArray.map((news, index) => {
                // Ensure all required properties exist
                const safeNews = {
                    id: news.id || Date.now() + index,
                    title: news.title || 'Berita Tanpa Judul',
                    category: news.category || 'UMUM',
                    excerpt: news.excerpt || news.title?.substring(0, 100) + '...' || 'Tidak ada ringkasan tersedia',
                    time: news.time || 'Baru saja',
                    views: news.views || '0',
                    images: news.images || [],
                    icon: news.icon || 'fas fa-newspaper',
                    gradient: news.gradient || 'from-gray-400 to-gray-500'
                };
                
                return `
                <article class="bg-white rounded-lg shadow-md overflow-hidden news-card cursor-pointer transform transition-all duration-300 hover:shadow-lg" onclick="showArticlePage('${safeNews.title.replace(/'/g, "\\'")}', ${safeNews.id})">
                    ${safeNews.images && safeNews.images.length > 0 ? `
                        <div class="aspect-square sm:aspect-mobile lg:aspect-square relative">
                            <img src="${safeNews.images[0]}" alt="${safeNews.title}" class="news-image" onerror="this.parentElement.innerHTML='<div class=\\'aspect-square sm:aspect-mobile lg:aspect-square bg-gradient-to-r ${safeNews.gradient} flex items-center justify-center\\'><i class=\\'${safeNews.icon} text-white text-2xl sm:text-3xl lg:text-4xl\\'></i></div>'">
                            ${safeNews.images.length > 1 ? `
                                <div class="absolute top-1 sm:top-2 right-1 sm:right-2 bg-black bg-opacity-70 text-white px-1 sm:px-2 py-1 rounded text-xs">
                                    +${safeNews.images.length - 1} foto
                                </div>
                            ` : ''}
                        </div>
                    ` : `
                        <div class="aspect-square sm:aspect-mobile lg:aspect-square bg-gradient-to-r ${safeNews.gradient} flex items-center justify-center">
                            <i class="${safeNews.icon} text-white text-2xl sm:text-3xl lg:text-4xl"></i>
                        </div>
                    `}
                    <div class="p-2 sm:p-3 lg:p-4">
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium">${safeNews.category}</span>
                        <h3 class="font-bold mt-2 text-sm sm:text-base lg:text-lg line-clamp-2 leading-tight">${safeNews.title}</h3>
                        <p class="text-gray-600 text-xs sm:text-sm mt-1 sm:mt-2 line-clamp-2 leading-relaxed">${safeNews.excerpt}</p>
                        <div class="flex items-center justify-between mt-2 sm:mt-3 text-gray-500 text-xs">
                            <div class="flex items-center">
                                <i class="far fa-clock mr-1"></i>
                                <span>${safeNews.time}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="far fa-eye mr-1"></i>
                                <span>${safeNews.views}</span>
                            </div>
                        </div>
                    </div>
                </article>
            `;
            }).join('');
        }

        // Live button functionality
        const liveButton = document.querySelector('.bg-red-600');
        if (liveButton) {
            liveButton.addEventListener('click', function() {
                alert('Streaming langsung akan segera dimulai!');
            });
        }

        // Function to show article page
        window.showArticlePage = function(title, newsId = 0) {
            console.log('Opening article:', title, 'ID:', newsId);
            
            // Find the news item
            let newsItem = null;
            
            // Search in admin news first
            if (newsId && newsId !== 0) {
                newsItem = adminNews.find(news => news.id == newsId);
                console.log('Found in admin news:', newsItem ? 'Yes' : 'No');
            }
            
            // If not found, search in regular news database
            if (!newsItem) {
                const allNews = Object.values(newsDatabase).flat();
                newsItem = allNews.find(news => news.title === title || news.id == newsId);
                console.log('Found in default news:', newsItem ? 'Yes' : 'No');
            }
            
            // If still not found, create a basic news item
            if (!newsItem) {
                console.log('Creating default news item for:', title);
                newsItem = {
                    id: newsId || Date.now(),
                    title: title,
                    category: 'UMUM',
                    author: 'Tim Redaksi',
                    excerpt: title.substring(0, 100) + '...',
                    time: Math.floor(Math.random() * 12) + 1 + ' jam yang lalu',
                    views: Math.floor(Math.random() * 2000) + 500,
                    images: []
                };
            }
            
            // Generate content if not available
            let content = '';
            if (newsItem.content) {
                content = newsItem.content;
            } else {
                content = generateDefaultContent(newsItem.title, newsItem.excerpt);
            }
            
            const author = newsItem.author || 'Tim Redaksi';
            const images = newsItem.images || [];
            const newsUrl = generateNewsUrl(title, newsItem.id);
            
            console.log('Displaying article with content length:', content.length);
            
            const articleContent = `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4" id="articleModal">
                    <div class="modal-content bg-white rounded-lg max-w-4xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
                        <div class="p-3 sm:p-4 lg:p-6">
                            <div class="flex justify-between items-start mb-3 sm:mb-4">
                                <h1 class="text-base sm:text-lg lg:text-xl xl:text-2xl font-bold text-gray-800 pr-2 sm:pr-4 leading-tight">${title}</h1>
                                <button onclick="closeArticle()" class="text-gray-500 hover:text-gray-700 text-xl sm:text-2xl flex-shrink-0 p-1">&times;</button>
                            </div>
                            <div class="flex flex-col sm:flex-row sm:items-center text-xs sm:text-sm text-gray-500 mb-3 sm:mb-4 space-y-1 sm:space-y-0">
                                <span><i class="far fa-clock mr-1"></i> ${newsItem.time}</span>
                                <span class="hidden sm:inline mx-2">•</span>
                                <span><i class="far fa-user mr-1"></i> ${author}</span>
                                <span class="hidden sm:inline mx-2">•</span>
                                <span><i class="far fa-eye mr-1"></i> ${newsItem.views} views</span>
                            </div>
                            
                            <!-- Share URL Display -->
                            <div class="bg-gray-50 p-2 sm:p-3 rounded-lg mb-3 sm:mb-4">
                                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-2 sm:space-y-0">
                                    <div class="flex-1 min-w-0">
                                        <p class="text-xs text-gray-500 mb-1">Link Berita:</p>
                                        <p class="text-xs sm:text-sm text-blue-600 break-all" id="newsUrl">${newsUrl}</p>
                                    </div>
                                    <button onclick="copyNewsUrl('${newsUrl.replace(/'/g, "\\\'")}')" class="sm:ml-2 bg-blue-600 text-white px-2 sm:px-3 py-1 rounded text-xs hover:bg-blue-700 flex-shrink-0">
                                        <i class="fas fa-copy mr-1"></i>Salin
                                    </button>
                                </div>
                            </div>
                            
                            ${images && images.length > 0 ? `
                                <div class="mb-3 sm:mb-4 lg:mb-6">
                                    <div class="aspect-video sm:aspect-square lg:aspect-video w-full max-w-2xl mx-auto">
                                        <img src="${images[0]}" alt="${title}" class="w-full h-full object-cover rounded-lg">
                                    </div>
                                    ${images.length > 1 ? `
                                        <div class="grid grid-cols-3 gap-1 sm:gap-2 mt-2 max-w-2xl mx-auto">
                                            ${images.slice(1, 4).map(img => `
                                                <div class="aspect-square">
                                                    <img src="${img}" alt="Additional image" class="w-full h-full object-cover rounded cursor-pointer hover:opacity-80 transition-opacity" onclick="showImageModal('${img}')">
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            ` : `
                                <div class="aspect-video sm:aspect-square lg:aspect-video w-full max-w-2xl mx-auto bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg mb-3 sm:mb-4 lg:mb-6 flex items-center justify-center">
                                    <i class="fas fa-image text-white text-2xl sm:text-3xl lg:text-4xl"></i>
                                </div>
                            `}
                            
                            <div class="prose max-w-none text-xs sm:text-sm lg:text-base">
                                ${content.split('\n').map(paragraph => 
                                    paragraph.trim() ? `<p class="text-gray-700 leading-relaxed mb-3 sm:mb-4">${paragraph.trim()}</p>` : ''
                                ).join('')}
                            </div>
                            <div class="mt-3 sm:mt-4 lg:mt-6 pt-3 sm:pt-4 lg:pt-6 border-t">
                                <h3 class="font-bold mb-2 sm:mb-3 text-sm sm:text-base">Bagikan Artikel:</h3>
                                <div class="grid grid-cols-2 sm:flex sm:flex-row gap-2 sm:space-y-0 sm:space-x-2 lg:space-x-4">
                                    <a href="#" onclick="shareToFacebook('${title.replace(/'/g, "\\'")}', '${newsUrl.replace(/'/g, "\\\'")}')" class="bg-blue-600 text-white px-3 sm:px-4 py-2 rounded hover:bg-blue-700 text-center text-xs sm:text-sm transition-colors">
                                        <i class="fab fa-facebook mr-1 sm:mr-2"></i>Facebook
                                    </a>
                                    <a href="#" onclick="shareToTwitter('${title.replace(/'/g, "\\'")}', '${newsUrl.replace(/'/g, "\\\'")}')" class="bg-blue-400 text-white px-3 sm:px-4 py-2 rounded hover:bg-blue-500 text-center text-xs sm:text-sm transition-colors">
                                        <i class="fab fa-twitter mr-1 sm:mr-2"></i>Twitter
                                    </a>
                                    <a href="#" onclick="shareToWhatsApp('${title.replace(/'/g, "\\'")}', '${newsUrl.replace(/'/g, "\\\'")}')" class="bg-green-600 text-white px-3 sm:px-4 py-2 rounded hover:bg-green-700 text-center text-xs sm:text-sm transition-colors">
                                        <i class="fab fa-whatsapp mr-1 sm:mr-2"></i>WhatsApp
                                    </a>
                                    <button onclick="copyNewsUrl('${newsUrl.replace(/'/g, "\\\'")}')" class="bg-gray-600 text-white px-3 sm:px-4 py-2 rounded hover:bg-gray-700 text-center text-xs sm:text-sm transition-colors">
                                        <i class="fas fa-link mr-1 sm:mr-2"></i>Salin Link
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', articleContent);
        }

        // Generate unique URL for news
        function generateNewsUrl(title, newsId) {
            const baseUrl = window.location.origin + window.location.pathname;
            const slug = title.toLowerCase()
                .replace(/[^a-z0-9\s]/g, '')
                .replace(/\s+/g, '-')
                .substring(0, 50);
            return `${baseUrl}?news=${encodeURIComponent(slug)}&id=${newsId}`;
        }

        // Copy news URL function
        window.copyNewsUrl = function(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Link berita berhasil disalin!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Link berita berhasil disalin!');
            });
        }

        // Share functions
        window.shareToFacebook = function(title, url) {
            const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(title)}`;
            window.open(shareUrl, '_blank', 'width=600,height=400');
        }

        window.shareToTwitter = function(title, url) {
            const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`;
            window.open(shareUrl, '_blank', 'width=600,height=400');
        }

        window.shareToWhatsApp = function(title, url) {
            const shareUrl = `https://wa.me/?text=${encodeURIComponent(title + ' - ' + url)}`;
            window.open(shareUrl, '_blank');
        }

        window.copyLink = function(title, url) {
            copyNewsUrl(url);
        }

        window.showImageModal = function(imageSrc) {
            const modal = `
                <div class="fixed inset-0 bg-black bg-opacity-75 z-60 flex items-center justify-center p-4" onclick="this.remove()">
                    <img src="${imageSrc}" alt="Full size image" class="max-w-full max-h-full object-contain">
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        // Function to close article
        window.closeArticle = function() {
            const modal = document.getElementById('articleModal');
            if (modal) {
                modal.remove();
            } else {
                // Fallback - remove any modal with the class
                const fallbackModal = document.querySelector('.fixed.inset-0.bg-black');
                if (fallbackModal) {
                    fallbackModal.remove();
                }
            }
        }

        // Test connection function
        window.testConnection = async function() {
            if (!checkConfiguration()) {
                return;
            }
            
            const testBtn = event.target;
            const originalText = testBtn.innerHTML;
            testBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing...';
            testBtn.disabled = true;
            
            try {
                console.log('Testing connection to:', GOOGLE_SCRIPT_URL);
                
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=test', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                console.log('Test response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Test response data:', data);
                    
                    alert('✅ Koneksi berhasil!\n\nGoogle Apps Script dapat diakses dengan baik.\nAnda dapat melakukan sinkronisasi data.');
                    
                    // Update connection status
                    isOnlineMode = true;
                    updateConnectionStatus();
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('Connection test failed:', error);
                
                let errorMessage = '❌ Test koneksi gagal!\n\n';
                
                if (error.message.includes('Failed to fetch')) {
                    errorMessage += 'Kemungkinan penyebab:\n';
                    errorMessage += '• Google Apps Script belum di-deploy\n';
                    errorMessage += '• Pengaturan "Who has access" bukan "Anyone"\n';
                    errorMessage += '• ID Script salah\n';
                    errorMessage += '• Masalah koneksi internet';
                } else if (error.message.includes('404')) {
                    errorMessage += 'Google Apps Script tidak ditemukan.\n';
                    errorMessage += 'Pastikan ID Script sudah benar dan sudah di-deploy.';
                } else {
                    errorMessage += `Error: ${error.message}`;
                }
                
                alert(errorMessage);
                
                isOnlineMode = false;
                updateConnectionStatus();
            } finally {
                testBtn.innerHTML = originalText;
                testBtn.disabled = false;
            }
        }

        // Show Google Apps Script code
        window.showGASCode = function() {
            const gasCode = `function doGet(e) {
  const action = e.parameter.action;
  
  if (action === 'test') {
    return ContentService.createTextOutput(JSON.stringify({status: 'ok'}))
      .setMimeType(ContentService.MimeType.JSON);
  }
  
  if (action === 'getNews') {
    return getNews();
  }
  
  return ContentService.createTextOutput(JSON.stringify({error: 'Invalid action'}))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const action = data.action;
    
    if (action === 'addNews') {
      return addNews(data.data);
    } else if (action === 'updateNews') {
      return updateNews(data.id, data.data);
    } else if (action === 'deleteNews') {
      return deleteNews(data.id);
    }
    
    return ContentService.createTextOutput(JSON.stringify({success: false, error: 'Invalid action'}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({success: false, error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function getSpreadsheet() {
  // Ganti dengan ID Google Sheet Anda
  const SHEET_ID = 'YOUR_GOOGLE_SHEET_ID_HERE';
  return SpreadsheetApp.openById(SHEET_ID).getActiveSheet();
}

function getNews() {
  try {
    const sheet = getSpreadsheet();
    const data = sheet.getDataRange().getValues();
    
    if (data.length <= 1) {
      return ContentService.createTextOutput(JSON.stringify({news: []}))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const headers = data[0];
    const news = [];
    
    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      const newsItem = {
        id: row[0],
        title: row[1],
        category: row[2],
        author: row[3],
        excerpt: row[4],
        content: row[5],
        images: row[6] ? JSON.parse(row[6]) : [],
        date: row[7],
        time: row[8],
        views: row[9],
        icon: getCategoryIcon(row[2]),
        gradient: getCategoryGradient(row[2])
      };
      news.push(newsItem);
    }
    
    return ContentService.createTextOutput(JSON.stringify({news: news}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({news: [], error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function addNews(newsData) {
  try {
    const sheet = getSpreadsheet();
    
    const newRow = [
      newsData.id,
      newsData.title,
      newsData.category,
      newsData.author,
      newsData.excerpt,
      newsData.content,
      JSON.stringify(newsData.images || []),
      newsData.date,
      newsData.time,
      newsData.views
    ];
    
    sheet.appendRow(newRow);
    
    return ContentService.createTextOutput(JSON.stringify({success: true}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({success: false, error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function updateNews(newsId, newsData) {
  try {
    const sheet = getSpreadsheet();
    const data = sheet.getDataRange().getValues();
    
    for (let i = 1; i < data.length; i++) {
      if (data[i][0] == newsId) {
        sheet.getRange(i + 1, 1, 1, 10).setValues([[
          newsData.id,
          newsData.title,
          newsData.category,
          newsData.author,
          newsData.excerpt,
          newsData.content,
          JSON.stringify(newsData.images || []),
          newsData.date,
          newsData.time,
          newsData.views
        ]]);
        
        return ContentService.createTextOutput(JSON.stringify({success: true}))
          .setMimeType(ContentService.MimeType.JSON);
      }
    }
    
    return ContentService.createTextOutput(JSON.stringify({success: false, error: 'News not found'}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({success: false, error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function deleteNews(newsId) {
  try {
    const sheet = getSpreadsheet();
    const data = sheet.getDataRange().getValues();
    
    for (let i = 1; i < data.length; i++) {
      if (data[i][0] == newsId) {
        sheet.deleteRow(i + 1);
        
        return ContentService.createTextOutput(JSON.stringify({success: true}))
          .setMimeType(ContentService.MimeType.JSON);
      }
    }
    
    return ContentService.createTextOutput(JSON.stringify({success: false, error: 'News not found'}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({success: false, error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function getCategoryIcon(category) {
  const icons = {
    'UMUM': 'fas fa-newspaper',
    'POLITIK': 'fas fa-gavel',
    'EKONOMI': 'fas fa-chart-line',
    'OLAHRAGA': 'fas fa-futbol',
    'TEKNOLOGI': 'fas fa-laptop',
    'HIBURAN': 'fas fa-film',
    'PENDIDIKAN': 'fas fa-graduation-cap'
  };
  return icons[category] || 'fas fa-newspaper';
}

function getCategoryGradient(category) {
  const gradients = {
    'UMUM': 'from-green-400 to-teal-500',
    'POLITIK': 'from-red-400 to-pink-500',
    'EKONOMI': 'from-blue-400 to-indigo-500',
    'OLAHRAGA': 'from-orange-400 to-red-500',
    'TEKNOLOGI': 'from-purple-400 to-pink-500',
    'HIBURAN': 'from-pink-400 to-rose-500',
    'PENDIDIKAN': 'from-blue-400 to-indigo-500'
  };
  return gradients[category] || 'from-gray-400 to-gray-500';
}`;

            document.getElementById('gasCode').textContent = gasCode;
            
            // Add copy button
            const copyBtn = document.createElement('button');
            copyBtn.innerHTML = '<i class="fas fa-copy mr-2"></i>Copy Code';
            copyBtn.className = 'mt-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-sm';
            copyBtn.onclick = function() {
                navigator.clipboard.writeText(gasCode).then(() => {
                    alert('Kode Google Apps Script berhasil disalin!');
                }).catch(() => {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = gasCode;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('Kode Google Apps Script berhasil disalin!');
                });
            };
            
            const codeContainer = document.getElementById('gasCode').parentElement;
            codeContainer.appendChild(copyBtn);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96000239e67ffce3',t:'MTc1MjY1MzI3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
